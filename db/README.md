# База данных AutoTrend

## Структура хранилища данных

Проект использует многослойную архитектуру хранилища данных:

### STG (Staging) - stg_autotrend
- Слой для хранения сырых данных из источников
- Минимальные преобразования
- Сохранение исторических данных
- Структура соответствует источнику

### ODS (Operational Data Store) - ods_autotrend
- Слой очищенных данных
- Корректные типы данных
- Базовые проверки качества
- Сохранение бизнес-логики источника

### DDS (Detail Data Store) - dds_autotrend
- Нормализованные данные
- Связи между сущностями
- Бизнес-сущности
- История изменений

### DM (Data Marts) - dm_autotrend
- Агрегированные данные
- Витрины для анализа
- Оптимизированные для запросов
- Специализированные срезы

## Структура директорий

Каждая схема содержит следующие директории:
- `tables/` - SQL-скрипты создания таблиц
- `views/` - SQL-скрипты создания представлений
- `functions/` - SQL-скрипты создания функций
- `grants/` - SQL-скрипты назначения прав доступа
- `scripts/` - Вспомогательные скрипты (миграции, очистка и т.д.)
- `schema.sql` - Создание схемы

## Основные сущности

### Справочники
- Регионы
- Марки и модели
- Комплектации
- Дилеры

### Транзакционные данные
- Объявления
- Цены
- Статистика просмотров

### Аналитические данные
- Тренды цен
- Популярность моделей
- Активность дилеров

## Правила разработки

1. Все объекты БД должны быть созданы через SQL-скрипты
2. Каждый скрипт должен быть идемпотентным
3. Все изменения схемы должны быть документированы
4. Следует использовать параметризованные запросы
5. Необходимо реализовать обработку ошибок
6. Важно поддерживать актуальность документации

## Инициализация

Для создания базовой структуры БД выполните:
```bash
# Создание схем
psql -f stg_autotrend/schema.sql
psql -f ods_autotrend/schema.sql
psql -f dds_autotrend/schema.sql
psql -f dm_autotrend/schema.sql

# Назначение прав
psql -f stg_autotrend/grants/01_basic_grants.sql
psql -f ods_autotrend/grants/01_basic_grants.sql
psql -f dds_autotrend/grants/01_basic_grants.sql
psql -f dm_autotrend/grants/01_basic_grants.sql
```
